
# Непрерывность работы бизнеса (Business Continuity)
Процессы и процедуры для гарантии непрерывности бизнес операций. Решения для **BC** направлены на проблемы недоступности и сниженной производительности приложений. BC включает весь бизнес процесс и действия для гарантии доступности информации ("information availability").

---

## Воздействие времени простоя
- Среднее время между сбоями (**MTBF**) = общее время работы / число сбоев
- Среднее время на восстановление (**MTTR**) = общее время простоя / число сбоев
- Доступность информации (**IA**) = MTBF / (MTBF + MTTR) или время работы / (время работы + время простоя)

---

## Измерение доступности информации (Information Availability)
- Время на выявление инцидента
- Время устранения или простой (downtime)
- Инциденты

### RPO и RTO
- **RPO** (Recovery Point Objective) - целевая точка восстановления, количество данных, потерю которых бизнес может выдержать.
- **RTO** (Recovery Time Objective) - целевое время восстановления, продолжительность времени простоя, которое бизнес может выдержать.

---

## Решения и технологии для обеспечения непрерывности бизнес процесса и непрерывной доступности данных
- Исключение единых точек сбоя (single points of failure)
- ПО для управления путями ввода-вывода (multi-pathing software)
- Бэкап (backup)
- Репликация (локальная и удалённая)

---

## Бэкап - дополнительная копия данных для восстановления при утрате или повреждении основной копии
- Может создаваться через простое копирование данных или зеркалирование
- Цели бэкапа: восстановление после катастрофы, операционный бэкап, архивирование

---

## Варианты грануляции бэкапа
- Полный бэкап (full backup)
- Инкрементный бэкап (incremental backup)
- Кумулятивный (дифференциальный) бэкап (cumulative backup)


---

  

# Бэкап клиент (Backup client)

## Компоненты бэкапа
- **Бэкап клиент**: Отправляет бэкап данные бэкап серверу или узлу хранения.
- **Бэкап сервер**: Управляет бэкап операциями и поддерживает бэкап каталог.
- **Узел хранения**: Отвечает за запись данных на бэкап устройство.
- **Бэкап устройство**: Сохраняет бэкап данные.

---

## Операции бэкапа и восстановления
- **Операция бэкапа**:
  - Бэкап сервер инициирует запланированный бэкап.
  - Узлы хранения загружают медиа-устройства для бэкапа, клиенты отправляют бэкап данные узлам хранения.
  - Узел хранения передает бэкап данные и медиа-информацию бэкап серверу.
  - Бэкап сервер обновляет каталог и сохраняет статус.

- **Операция восстановления**:
  - Бэкап клиент инициирует восстановление.
  - Бэкап сервер идентифицирует данные для восстановления и инструктирует узел хранения загрузить бэкап медиа устройства.
  - Узел хранения восстанавливает данные клиенту и отправляет метаданные бэкап серверу.

---

## Реализации бэкап технологий
- **Бэкап на кассету (Tape)**:
  - Физическая кассетная библиотека.

- **Бэкап на диск (Disk)**:
  - Виртуальная кассетная библиотека.

---

## Улучшенная общая производительность бэкапа и восстановления
- **Бэкап на диск**:
  - Случайный доступ (random access).
  - Более надежный, чем магнитная лента.
  - Несколько хостов могут иметь одновременный доступ.
  - Время полного восстановления сокращено.

---

## Бэкап на виртуальную ленту (Virtual Tape)
- Диски эмулируются как магнитные ленты для ПО для бэкапа.
- Исключаются дополнительные модули или изменения в существующем ПО для бэкапа.
- Улучшенная производительность и надежность по сравнению с физической лентой.
- Случайный и онлайн доступ к данным.
- Быстрее операции бэкапа и восстановления.
  

---

  

# Оптимизация бэкапа: Дедупликация

Дедупликация – это технология, исключающая повторяющиеся данные для сокращения пространства хранения и сетевого трафика.

- Может быть реализована на:
  - Файловом уровне
  - Блочном/chunk уровне
- Дедупликация бывает:
  - На базе источника (клиента)
  - На базе приемника (устройства хранения)

---

## Преимущества дедупликации
- Меньшая инфраструктура для хранения бэкапов
- Снижение стоимости инфраструктуры
- Сокращение объема избыточного контента при ежедневном бэкапе
- Увеличенный срок хранения данных
- Уменьшение времени бэкапа и ускорения восстановления
- Создание ежедневных бэкап образов

---

## Дедупликация на базе источника (Source Based Deduplication)
- Данные дедуплицируются на источнике (бэкап клиент)
- Клиент отправляет только новые, уникальные сегменты
- Экономия пространства на системе хранения, увеличение нагрузки на бэкап клиент

## Дедупликация на базе приемника (Target Based Deduplication)
- Данные дедуплицируются на приемнике (целевом устройстве)
- Клиент отправляет исходные данные на бэкап устройство
- Требует больше пропускной способности сети и пространства на системе хранения

---

## Методы дедупликации
- Single Instance Storage (SIS):
  - Удаляет избыточные копии идентичных данных
  - Все ссылки указывают на оригинальную копию
- Дедупликация на под-файловом уровне:
  - Отфильтровывает повторяющиеся сегменты внутри файлов
  - Работает в пределах одной системы и между несколькими системами
- Компрессия:
  - Сокращает размер файла
  - Идентифицирует и удаляет пустоты и повторяющиеся блоки данных
  - Может применяться на уровне источника и приемника

---

## Репликация – Процесс создания точной копии данных
- Предпосылки для репликации:
  - Альтернативный источник бэкапа
  - Быстрое восстановление
  - Поддержка принятия решений
  - Платформа для тестирования
  - Восстановление работы с реплики
- Классификация репликации:
  - Локальная репликация
  - Удаленная репликация

---

## Реплика: Типы и характеристики
- Типы реплик:
  - Точка во времени (Point-in-Time, PIT) – ненулевое RPO
  - Непрерывная (Continuous) – близкое к нулю RPO
- Характеристики хорошей реплики:
  - Восстанавливаемость (Recoverability)
  - Возможность рестарта (Restartability)
  - Согласованность (Consistency)

---

## Локальная репликация
- Репликация данных в одном массиве или центре обработки данных (ЦОД)
- Репликация на базе вычислительного устройства (Compute based replication)
  - Выполняется с использованием ресурсов CPU вычислительных устройств

---
# Зеркалирование менеджера логических томов (LVM based mirroring)

Репликация на базе вычислительного устройства

- Каждое логическое деление логического тома отображается на два физических деления на двух физических томах
- Запись на логическое деление происходит на оба физических деления
- Снимок файловой системы (File System Snapshot) использует принцип Copy on First Write (CoFW)
- Используются битовые и блоковые маски (bitmap and block map)
- Требуется дополнительное пространство для производственной файловой системы (production FS)

---

## Локальная репликация на базе массива хранения (Storage Array-based Local Replication)

- Репликация выполняется в операционном окружении массива
- Источник и реплика находятся в рамках одного массива
- Типы репликации на базе хоста:
  - Полное зеркалирование тома (Full-volume mirroring)
  - Репликация логического тома на основе массива указателей (Pointer-based full-volume replication)
  - Виртуальная репликация на основе массива указателей (Pointer-based virtual replication)

---

## Зеркалирование логического тома (Full-Volume Mirroring)

- Приемник является полной физической копией устройства источника
- Приёмник подключается к источнику, и данные копируются на приёмник
- Приёмник недоступен в момент подключения
- Размер устройства приёмника должен быть не меньше, чем у источника

---

## Репликация тома на основе массива указателей

- Обеспечивает полную копию данных источника на приёмник
- Устройство приёмника доступно для бизнес операций сразу после начала процесса репликации
- Point-in-Time (PIT) определяется временем начала сессии репликации
- Два режима:
  - Копирование по первому доступу (Copy on First Access)
  - Полное копирование (Full Copy)
- Размер устройства приёмника должен быть не меньше, чем у источника

---

## Копирование по первому доступу (CoFA): Запись на источник

- Оригинальные данные по указанному адресу копируются на приёмник
- Новые данные записываются на источнике
- Гарантируется наличие оригинальных данных, соответствующих указанной PIT на приёмнике

---

## Копирование по первому доступу (CoFA): Запись на приёмник

- Оригинальные данные копируются с источника на приёмник
- Новые данные записываются на приёмник

---

## Копирование по первому доступу (CoFA): Чтение на приёмнике

- Оригинальные данные копируются с источника на приёмник и становятся доступными для хоста непрерывности бизнеса (BC Host)

---

## Виртуальная репликация на основе массива указателей

- Приёмник хранит не сами данные, а указатели на их местоположение
- Для приёмника требуется небольшая доля дискового пространства по сравнению с источником
- Приёмник доступен сразу после активации сессии
- Используется принцип Copy on First Write (CoFW)
- После первой записи от источника или приёмника оригинальные данные копируются в специальное хранилище
---

  

# Виртуальная репликация на базе массива указателей (Pointer-based Virtual Replication (CoFW)): Запись на источник

**Виртуальная репликация на базе массива указателей (Pointer-based Virtual Replication (CoFW)): Запись на источник**

В случае первой записи на источнике после активации сессии репликации:

- Оригинальные данные по данному адресу копируются в специально выделенное пространство.
- Указатель на приемнике обновляется и указывает на данные в выделенном пространстве.
- Новая запись появляется на источнике.

## Запись на источник

---

# Виртуальная репликация на базе массива указателей (CoFW): Запись на приемник

**Виртуальная репликация на базе массива указателей (CoFW): Запись на приемник**

Первой записи на приемник (Target) после активации сессии репликации:

- Оригинальные данные от источника копируются в специально выделенное пространство.
- Указатель обновляется и указывает на данные в выделенном пространстве.
- Еще одна копия оригинальных данных создается в специально выделенном пространстве перед тем, как новая операция записи происходит в специально выделенном пространстве.

---

# Слайд 33

**Сравнение технологий локальной репликации**

---

# Локальная репликация на базе сети: Непрерывная защита данных (Continuous Data Protection, CDP)

**Локальная репликация на базе сети: Непрерывная защита данных (Continuous Data Protection, CDP)**

- Репликация происходит на уровне сети между хостами и массивами хранения данных.
- Идеально подходит для разнородного окружения.
- Обычно позволяет восстанавливать данные до любой из предыдущих точек восстановления (PIT).
- Время восстановления данных (RPO) может варьироваться и нет необходимости определять его заранее.
- Изменения данных непрерывно фиксируются и сохраняются в отдельном от производственных данных месте.

### Компоненты CDP:

- Том журналирования (Journal volume)
- Устройство непрерывной защиты данных (CDP appliance)
- Сплиттер записи (Write splitter)

---

# Справляется с рисками, связанными с выходами из строя систем, по причинам региональных катастроф

**Удалённая репликация**

- Справляется с рисками, связанными с выходами из строя систем, по причинам региональных катастроф.

### Режимы удалённой репликации (на основании требований RPO):

- **Синхронная**: Реплика всегда идентична источнику (около нулевого RPO).
- **Асинхронная**: Реплика отстаёт от источника на конечное время (конечное RPO).

- Между источником и приёмником необходимо наличие сетевой инфраструктуры.
- Процесс создания и поддержки копий данных от стороны источника (production site) к удалённым сторонам (remote site(s)).

---

# Слайд 36

**Синхронная и асинхронная репликация**

---

# Удалённая репликация на основе вычислительной системы

**Удалённая репликация на основе вычислительной системы**

- Репликация выполняется средствами ресурсов CPU на вычислительной системе, при помощи ПО, запущенного на вычислительной системе.

### Методы удалённой репликации:

- **Репликация на основе менеджера логических томов (LVM-based)**:
  - Все операции записи на группу томов источника реплицируются на тома приёмника с помощью менеджера логических томов.
  - Может быть синхронной и асинхронной.

- **Доставка журналов баз данных (Log shipping)**:
  - Транзакции на базы данных источника фиксируются в журнале и периодически отправляются на удалённую сторону.
  - Удалённая вычислительная система применяет журналы к удалённой базе данных.
  
  
  

---

  

# Выполняется операционным окружением массива

**Удаленная репликация на основе массива хранения**

- Выполняется операционным окружением массива.
- Синхронная репликация.
- Асинхронная репликация.
- Дисковая буферизация (показано на рисунке).
- Комбинация локальной и удаленной репликаций.
- RPO обычно порядка часов.
- Низкие требования к пропускной способности сети.
- Решение для длинных дистанций.

---

# Итоги

**Основные понятия, раскрытые в данной лекции:**

- Непрерывность бизнес-процесса 📈
- Бэкап, грануляция бэкапа 💾
- Оптимизация бэкапа: дедупликация 🔍
- Репликация. Локальная и удаленная репликация 🔄